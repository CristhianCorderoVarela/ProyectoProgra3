<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="cr.ac.una.restunaclient.controller.OrdenesController"
            style="-fx-background-color: #F5F5F0;">

    <!-- TOP: Header -->
    <top>
        <VBox spacing="10" style="-fx-background-color: white;">
            <padding><Insets top="15" bottom="15" left="30" right="30"/></padding>

            <fx:define>
                <ToggleGroup fx:id="tgTipoOrden"/>
            </fx:define>
            
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label fx:id="lblTitle" text="📝 Gestión de Orden">
                    <font><Font name="System Bold" size="22"/></font>
                </Label>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="lblUsuario" text="Salonero: Juan Pérez" style="-fx-text-fill: #333;">
                    <font><Font size="13"/></font>
                </Label>
                <Button fx:id="btnVolver" text="← Volver" onAction="#onVolver" 
                        style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-cursor: hand; -fx-background-radius: 8;">
                    <font><Font size="13"/></font>
                </Button>
            </HBox>

            <HBox spacing="12" alignment="CENTER_LEFT">
                <Label text="Tipo de Orden:" style="-fx-font-weight: bold;"/>

                <ToggleButton fx:id="tgMesa"
                              text="Mesa"
                              toggleGroup="$tgTipoOrden"
                              selected="true"
                              style="-fx-background-radius: 8; -fx-cursor: hand;"/>

                <ToggleButton fx:id="tgBarra"
                              text="Barra"
                              toggleGroup="$tgTipoOrden"
                              style="-fx-background-radius: 8; -fx-cursor: hand;"/>

                <Separator orientation="VERTICAL" prefHeight="20"/>

                <Label text="Salón:"/>
                <ComboBox fx:id="cmbSalonSelect" prefWidth="180" promptText="Seleccione"/>

                <Label text="Mesa:"/>
                <ComboBox fx:id="cmbMesaSelect" prefWidth="120" promptText="Seleccione"/>

                <Button fx:id="btnElegirMesa"
                        text="🪑 Elegir Mesa"
                        onAction="#onElegirMesa"
                        style="-fx-background-color: #17a2b8; -fx-text-fill: white; -fx-background-radius: 8; -fx-cursor: hand;">
                    <font><Font size="12"/></font>
                </Button>

                <Region HBox.hgrow="ALWAYS"/>

                <Label fx:id="lblEstadoOrden" text="Nueva" style="-fx-text-fill: #666;">
                    <font><Font size="12"/></font>
                </Label>
            </HBox>
            
            <HBox spacing="20" alignment="CENTER_LEFT">
                <Label fx:id="lblMesaInfo" text="Mesa: —" style="-fx-font-weight: bold; -fx-text-fill: #FF7A00;">
                    <font><Font size="14"/></font>
                </Label>
                <Separator orientation="VERTICAL" prefHeight="20"/>
                <Label fx:id="lblSalonInfo" text="Salón: —" style="-fx-text-fill: #666;">
                    <font><Font size="13"/></font>
                </Label>
                <Separator orientation="VERTICAL" prefHeight="20"/>
                <Label fx:id="lblFechaHora" text="--/--/---- --:--" style="-fx-text-fill: #666;">
                    <font><Font size="13"/></font>
                </Label>

                <Separator orientation="VERTICAL" prefHeight="20"/>

                <Label text="Cliente:" style="-fx-text-fill: #666;">
                    <font><Font size="13"/></font>
                </Label>
                <ComboBox fx:id="cmbCliente"
                          editable="true"
                          promptText="Nombre, correo o teléfono"
                          prefWidth="320"/>

                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="btnCancelarOrden" text="❌ Cancelar Orden" onAction="#onCancelarOrden" 
                        style="-fx-background-color: #dc3545; -fx-text-fill: white; -fx-cursor: hand; -fx-background-radius: 8;">
                    <font><Font size="13"/></font>
                </Button>
            </HBox>
        </VBox>
    </top>
    
    <!-- CENTER: Contenido principal -->
    <center>
        <HBox spacing="15" BorderPane.alignment="CENTER">
            <padding><Insets top="15" bottom="15" left="30" right="30"/></padding>
            
            <!-- PANEL IZQUIERDO: Selector de productos -->
            <VBox spacing="15" prefWidth="450"
                  style="-fx-background-color: white; -fx-background-radius: 12;
                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <padding><Insets top="20" bottom="20" left="20" right="20"/></padding>
                
                <Label text="Seleccionar Productos" style="-fx-font-weight: bold; -fx-font-size: 16px;"/>
                
                <HBox spacing="10">
                    <TextField fx:id="txtBuscarProducto" promptText="Buscar producto..." HBox.hgrow="ALWAYS">
                        <font><Font size="13"/></font>
                    </TextField>
                    <ComboBox fx:id="cmbGrupos" prefWidth="180" promptText="Todos los grupos"/>
                </HBox>
                
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" 
                            style="-fx-background: transparent; -fx-background-color: transparent;">
                    <FlowPane fx:id="flowProductos" hgap="10" vgap="10" 
                              style="-fx-background-color: #F5F5F0; -fx-padding: 10; -fx-background-radius: 8;"/>
                </ScrollPane>
            </VBox>
            
            <!-- PANEL CENTRAL: Detalles de la orden -->
            <VBox spacing="15" HBox.hgrow="ALWAYS"
                  style="-fx-background-color: white; -fx-background-radius: 12;
                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <padding><Insets top="20" bottom="20" left="20" right="20"/></padding>
                
                <Label text="Detalles de la Orden" style="-fx-font-weight: bold; -fx-font-size: 16px;"/>
                
                <TableView fx:id="tblDetalles" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colProducto" text="Producto" prefWidth="250"/>
                        <TableColumn fx:id="colCantidad" text="Cant." prefWidth="70"/>
                        <TableColumn fx:id="colPrecio" text="Precio" prefWidth="100"/>
                        <TableColumn fx:id="colSubtotal" text="Subtotal" prefWidth="100"/>
                    </columns>
                    <placeholder>
                        <Label text="No hay productos agregados" style="-fx-text-fill: #999;"/>
                    </placeholder>
                </TableView>
                
                <Separator/>
                
                <VBox spacing="5">
                    <Label text="Observaciones:" style="-fx-font-weight: bold;"/>
                    <TextArea fx:id="txtObservaciones" prefHeight="80" wrapText="true"
                              promptText="Observaciones adicionales..."/>
                </VBox>
                
                <Separator/>
                
                <HBox spacing="15" alignment="CENTER">
                    <Label text="TOTAL:" style="-fx-font-weight: bold; -fx-font-size: 18px;"/>
                    <Label fx:id="lblTotal" text="₡0.00"
                           style="-fx-text-fill: #FF7A00; -fx-font-weight: bold; -fx-font-size: 24px;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button fx:id="btnGuardar" text="💾 Guardar Orden" onAction="#onGuardar"
                            style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-cursor: hand;
                                   -fx-background-radius: 8; -fx-font-size: 15px; -fx-padding: 12 30;">
                        <font><Font name="System Bold" size="15"/></font>
                    </Button>
                </HBox>
            </VBox>

            <!-- PANEL DERECHO NUEVO: Lista de Órdenes -->
            <VBox spacing="10" prefWidth="320"
                  style="-fx-background-color: white; -fx-background-radius: 12;
                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <padding><Insets top="20" bottom="20" left="20" right="20"/></padding>
                <Label text="Órdenes en curso" style="-fx-font-weight: bold; -fx-font-size: 16px;"/>
                <ScrollPane fx:id="scrollOrdenes" fitToWidth="true" VBox.vgrow="ALWAYS"
                            style="-fx-background-color: transparent;">
                    <VBox fx:id="vboxOrdenes" spacing="8">
    <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
</VBox>
                </ScrollPane>
            </VBox>

        </HBox>
    </center>
</BorderPane>